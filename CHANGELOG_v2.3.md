# 변경 사항 v2.3 - 리뷰 크롤링 기능 추가

## 🎯 주요 신기능

### 1. **이미지 셀렉터 정확도 개선**

**문제:**
- 기존 셀렉터로 이미지를 찾지 못함

**해결:**
- 실제 올리브영 HTML 구조 분석
- `img.s-lazy` 셀렉터 최우선 순위로 추가
- 이미지 추출 성공률 대폭 향상

**변경된 셀렉터:**
```python
selectors = [
    "img.s-lazy",           # ← NEW! 최우선 (실제 HTML 기반)
    ".detail_cont img",
    "#artcInfo img",
    # ... 기타 대체 셀렉터
]
```

### 2. **리뷰 자동 수집 기능** ⭐ NEW!

**기능 개요:**
- 상품 리뷰를 모든 페이지에서 자동 수집
- 페이지네이션 자동 처리
- 텍스트 파일로 저장

**작동 방식:**
1. 리뷰 탭 자동 클릭
2. 총 페이지 수 확인
3. 각 페이지별로 순회하며 리뷰 수집
4. `reviews.txt` 파일로 저장

**수집 정보:**
- 리뷰 텍스트 (`.txt_inner` 영역)
- 총 리뷰 개수
- 페이지별 리뷰 구분

## 📋 새로운 파일

### `src/review_crawler.py`
리뷰 크롤링 전담 모듈

**주요 메서드:**
```python
class ReviewCrawler:
    def click_review_tab()                    # 리뷰 탭 클릭
    def get_total_pages()                     # 총 페이지 수 확인
    def extract_reviews_from_current_page()   # 현재 페이지 리뷰 추출
    def click_next_page(page_number)          # 다음 페이지로 이동
    def crawl_all_reviews()                   # 전체 리뷰 수집
    def save_reviews_to_file()                # 파일로 저장
```

## 🎨 UI 개선

### 사이드바 설정 추가

**새로운 옵션:**
```
⚙️ 설정
├─ [ ] 브라우저 표시
├─ 저장 형식: ● both
└─ [✓] 리뷰도 수집  ← NEW!
```

**리뷰 수집 옵션:**
- 체크: 리뷰도 함께 수집 (시간 추가 소요)
- 체크 해제: 이미지만 수집 (빠름)

## 📂 폴더 구조 (리뷰 포함)

```
data/
└── 251112_한율 달빛유자 비타민 톤업팩폼/
    ├── product_detail_merged.jpg    # 병합된 이미지
    ├── product_info.json            # 상품 정보 (JSON)
    ├── product_info.csv             # 상품 정보 (CSV)
    └── reviews.txt                  # 리뷰 텍스트 ← NEW!
```

## 📄 리뷰 파일 형식

`reviews.txt` 예시:
```
총 35개의 리뷰
================================================================================

[리뷰 1]
어른쑥 쓰다가 거의 다 써서 또 사야지~ 하고 있었는데 마침 얘가 나와서 샀어요!
일전에 유자 크림 써봤는데 향이 넘 좋았어서 종종 생각났었는데 얘도 향 진짜 좋아요 ㅋㅋ
--------------------------------------------------------------------------------

[리뷰 2]
가격대비 좋아요! 향도 은은하고 촉촉해서 만족스러워요
--------------------------------------------------------------------------------

...
```

## 🔄 크롤링 프로세스 (리뷰 포함)

### 변경 전 (이미지만)
```
1. 검색 (10%)
2. 상품 정보 추출 (30%)
3. 폴더 생성 (50%)
4. 상세 페이지 이동 (60%)
5. 더보기 클릭 (70%)
6. 이미지 추출 (80%)
7. 이미지 다운로드 (70-90%)
8. 데이터 저장 (90%)
9. 완료 (100%)
```

### 변경 후 (리뷰 포함 옵션)
```
1. 검색 (10%)
2. 상품 정보 추출 (30%)
3. 폴더 생성 (50%)
4. 상세 페이지 이동 (60%)
5. 더보기 클릭 (70%)
6. 이미지 추출 (80%)
7. 이미지 다운로드 (70-85%)
8. 리뷰 수집 (85-90%) ← NEW! (옵션)
9. 데이터 저장 (90%)
10. 완료 (100%)
```

## 🚀 사용 방법

### 기본 사용 (이미지만)
1. 검색어 입력
2. "검색 및 크롤링 시작" 클릭
3. 대기
4. 결과 확인

### 리뷰 포함 사용
1. 사이드바에서 "**리뷰도 수집**" 체크 ✅
2. 검색어 입력
3. "검색 및 크롤링 시작" 클릭
4. 대기 (시간이 조금 더 걸림)
5. 결과 확인 (reviews.txt 추가 생성됨)

## 📊 성능 영향

### 리뷰 수집 시간 (예상)

| 리뷰 개수 | 페이지 수 | 예상 소요 시간 |
|----------|----------|---------------|
| 10개 | 1페이지 | +5초 |
| 35개 | 4페이지 | +15초 |
| 100개 | 10페이지 | +30초 |
| 200개 | 20페이지 | +60초 |

**팁:** 리뷰가 많은 상품은 시간이 오래 걸릴 수 있으니 브라우저 표시를 켜고 진행 상황을 확인하세요!

## 🔍 리뷰 크롤링 상세 로그

콘솔에서 확인할 수 있는 정보:
```
📝 리뷰 탭 클릭 중...
✅ 리뷰 탭 클릭 완료
📄 총 4개 페이지 발견

📖 1/4 페이지 처리 중...
  현재 페이지에서 10개 리뷰 발견
    [1] 어른쑥 쓰다가 거의 다 써서...
    [2] 가격대비 좋아요! 향도 은은하고...
  ✅ 10개 리뷰 수집 완료 (누적: 10개)

📄 2페이지로 이동 중...
✅ 2페이지 클릭 완료
📖 2/4 페이지 처리 중...
  현재 페이지에서 10개 리뷰 발견
  ✅ 10개 리뷰 수집 완료 (누적: 20개)

...

✅ 총 35개 리뷰 수집 완료!
✅ 리뷰 저장 완료: data/.../reviews.txt
```

## ⚠️ 주의사항

### 1. 리뷰가 없는 상품
- 리뷰 탭이 없거나 리뷰가 0개인 경우
- reviews.txt 파일이 생성되지 않음
- 에러 없이 정상 완료됨

### 2. 페이지 로딩 시간
- 리뷰가 많을수록 시간 소요
- 인터넷 속도에 따라 변동
- 브라우저 표시 모드에서 확인 권장

### 3. 리뷰 내용
- 텍스트만 수집 (사진은 미포함)
- 별점, 작성자 ID는 미포함 (추가 가능)
- 순서는 페이지 표시 순서대로

## 🔧 향후 확장 가능 기능

### 현재 구현: ✅
- [x] 리뷰 텍스트 수집
- [x] 페이지네이션 자동 처리
- [x] 텍스트 파일 저장

### 향후 추가 가능: 💡
- [ ] 리뷰 작성자 ID 수집
- [ ] 별점 수집
- [ ] 리뷰 작성 날짜 수집
- [ ] 리뷰 이미지 다운로드
- [ ] CSV/JSON 형식으로 저장
- [ ] 리뷰 감성 분석 (긍정/부정)

## 📝 수정된 파일

1. **src/product_detail_crawler.py**
   - 이미지 셀렉터 개선 (`img.s-lazy` 추가)

2. **src/review_crawler.py** (NEW!)
   - 리뷰 크롤링 전담 모듈

3. **src/oliveyoung_crawler.py**
   - ReviewCrawler 통합

4. **app_v2.py**
   - "리뷰도 수집" 체크박스 추가
   - 리뷰 크롤링 로직 통합

## 🎉 업그레이드 완료!

**v2.3의 핵심:**
- 정확한 이미지 추출
- 자동 리뷰 수집
- 사용자 선택 가능한 옵션

---

**테스트 URL:** https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000237817
